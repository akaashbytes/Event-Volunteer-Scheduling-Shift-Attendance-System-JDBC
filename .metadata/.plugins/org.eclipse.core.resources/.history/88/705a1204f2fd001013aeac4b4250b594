package com.eventvol.service;

import java.sql.Connection;
import com.eventvol.bean.*;
import com.eventvol.dao.*;
import com.eventvol.util.*;

public class EventService {

    VolunteerDAO vdao = new VolunteerDAO();
    AssignmentDAO adao = new AssignmentDAO();

    public boolean registerNewVolunteer(Volunteer v) throws Exception {
        if (v.getFullName() == null || v.getPrimaryPhone() == null)
            throw new ValidationException();

        if (vdao.findVolunteer(v.getVolunteerID()) != null)
            return false;

        v.setStatus("ACTIVE");
        return vdao.insertVolunteer(v);
    }

    public boolean assignVolunteerToShift(String volId, int shiftId, String role)
            throws Exception {

        Connection con = DBUtil.getDBConnection();
        con.setAutoCommit(false);

        try {
            Assignment a = new Assignment();
            a.setAssignmentID(adao.generateAssignmentID(con));
            a.setVolunteerID(volId);
            a.setShiftID(shiftId);
            a.setAssignedRole(role);
            a.setAttendanceStatus("PENDING");

            boolean ok = adao.insertAssignment(con, a);
            con.commit();
            return ok;

        } catch (Exception e) {
            con.rollback();
            throw e;
        }
    }
}
